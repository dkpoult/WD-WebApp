<form [formGroup]="form" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
  <mat-expansion-panel [@fade] #panel fxFlex (opened)="panelOpenState = false" (closed)="panelOpenState = true"
    class="panel">
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{ titleCase(form.get('sessionType').value) }} in
        {{ form.get('venue').value['buildingCode'] ? form.get('venue').value['buildingCode'] + form.get('venue').value['subCode'] : "unspecified venue"}}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <mat-action-row fxLayoutAlign="start center">
      <!-- <span fxFlex></span> -->
      <mat-chip selected color="warn" (click)="removeSession()">
        <mat-icon>delete</mat-icon>
      </mat-chip>
    </mat-action-row>
    <!-- Content -->
    <div class="chips">
      <mat-chip-list formControlName="sessionType">
        <mat-chip *ngFor="let type of sessionTypes" value="{{ type.value }}" #chip="matChip" (click)="selectChip(chip)">
          {{ type.text }}
        </mat-chip>
      </mat-chip-list>
    </div>
    <form formGroupName="venue">
      <mat-autocomplete #buildingAuto="matAutocomplete">
        <mat-option *ngFor="let building of venues" [value]="building">
          {{ building }}
        </mat-option>
      </mat-autocomplete>
      <div fxLayout="col" fxLayoutAlign="start center" fxLayoutGap="23px" class="venue">
        <mat-form-field>
          <mat-label>Venue</mat-label>
          <input matInput formControlName="buildingCode" [matAutocomplete]="buildingAuto">
        </mat-form-field>
        <mat-form-field>
          <input matInput formControlName="subCode" autocomplete="off">
        </mat-form-field>
      </div>
    </form>
    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="5px" class="time">
      <mat-form-field id="start">
        <mat-label>Start Time</mat-label>
        <input matInput type="time" formControlName="time">
      </mat-form-field>
      <span> to </span>
      <mat-form-field id="end">
        <mat-label>End Time</mat-label>
        <input matInput type="time" formControlName="endTime">
      </mat-form-field>
    </div>
    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="5px" class="repeats">
      <mat-form-field id="fromDate" fxFlex="30">
        <mat-label>Beginning On</mat-label>
        <input matInput [matDatepicker]="startDatePicker" formControlName="date">
        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker [dateClass]="dateClass" #startDatePicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field id="repeatType">
        <mat-label>Repeats</mat-label>
        <mat-select formControlName="repeatType">
          <mat-option *ngFor="let type of repeatTypes" [value]="type.value">{{ type.text }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field *ngIf="form.get('repeatType').value !== 'ONCE'">
        <mat-label>Every</mat-label>
        <span matSuffix>{{ getPeriod(form.get('repeatType').value, form.get('repeatGap').value) }}</span>
        <input matInput type="number" formControlName="repeatGap">
      </mat-form-field>
    </div>
    <div fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="5px" class="cancellations">
      <div>
        <mat-label>Except dates</mat-label>
        <input matInput disabled #hiddenDateInput [matDatepicker]="cancelDatePicker" class="hiddenInPlace"
          (dateChange)="addCancellation($event.value)">
        <mat-datepicker-toggle matPrefix [for]="cancelDatePicker"></mat-datepicker-toggle>
        <mat-datepicker [dateClass]="dateClass" disabled="false" #cancelDatePicker></mat-datepicker>
      </div>
      <mat-chip-list>
        <mat-chip *ngFor="let cancellation of cancellations; let i = index" [removable]="true"
          (removed)="removeCancellation(i)">
          {{ cancellation }}
          <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
      </mat-chip-list>
    </div>
  </mat-expansion-panel>
</form>